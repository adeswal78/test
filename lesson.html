<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Lesson Detail</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f2f2f2;
      margin: 0;
      padding: 20px;
    }h1 {
  font-size: 24px;
  margin-bottom: 10px;
  color: #333;
  text-align: center;
}

.top-bar {
  display: flex;
  justify-content: center;
  margin-bottom: 20px;
}

.extract-btn {
  background: #ff9800;
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  font-size: 0.95rem;
}

.tabs {
  display: flex;
  justify-content: center;
  gap: 15px;
  margin-bottom: 20px;
}

.tabs button {
  padding: 10px 20px;
  border: none;
  border-radius: 6px;
  background: #e0e0e0;
  cursor: pointer;
  font-weight: bold;
  color: #555;
}

.tabs button.active {
  background: #673ab7;
  color: #fff;
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}

.item {
  background: #fff;
  padding: 15px;
  margin-bottom: 15px;
  border-radius: 10px;
  box-shadow: 0 3px 6px rgba(0,0,0,0.1);
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.item img {
  width: 100%;
  max-height: 180px;
  object-fit: cover;
  border-radius: 6px;
}

.pdf-item-name {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 1rem;
  color: #333;
  font-weight: 600;
}

.pdf-icon {
  width: 24px;
  height: 24px;
  flex-shrink: 0;
  color: #e53935;
  font-weight: bold;
  user-select: none;
}

.item h3 {
  margin: 0;
  font-size: 1rem;
  color: #333;
  font-weight: normal;
}

.btns {
  margin-top: 5px;
}

.btns a {
  display: inline-block;
  margin-right: 10px;
  padding: 8px 14px;
  border-radius: 4px;
  font-size: 0.9rem;
  font-weight: bold;
  color: #fff;
  text-decoration: none;
}

.btns a.kgs-btn {
  background: #512da8;
}

.btns a.yt-btn {
  background: #d32f2f;
}

.btns a.disabled {
  background: #aaa;
  pointer-events: none;
}

.btns a.download-btn {
  background: #388e3c;
}

  </style>
</head>
<body>  <h1 id="lessonTitle">Loading Lesson...</h1>
  <div class="top-bar">
    <button class="extract-btn" id="extractBtn">‚¨áÔ∏è Extract HTML</button>
  </div>  <div class="tabs">
    <button class="tab-btn active" data-tab="videos">Videos</button>
    <button class="tab-btn" data-tab="notes">Notes</button>
  </div>  <div id="videos" class="tab-content active"></div>
  <div id="notes" class="tab-content"></div>  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const courseId = urlParams.get('courseId');
    const lessonId = urlParams.get('lessonId');

    const videoContainer = document.getElementById('videos');
    const notesContainer = document.getElementById('notes');
    const titleEl = document.getElementById('lessonTitle');
    const extractBtn = document.getElementById('extractBtn');

    let allVideos = [], allNotes = [];

    fetch(`https://api.khanglobalstudies.com/cms/courses/${courseId}/lessons/${lessonId}`)
      .then(res => res.json())
      .then(data => {
        titleEl.textContent = data.name || "Lesson";
        allVideos = data.videos.filter(v => v.type !== 'pdf');
        allNotes = data.videos.filter(v => v.type === 'pdf');

        renderContent();
      });

    function renderContent() {
      allVideos.forEach(video => {
        const ytId = extractYouTubeId(video.video_url) || extractYouTubeId(video.thumb);
        const youtubeUrl = ytId ? `https://www.youtube.com/watch?v=${ytId}` : null;
        const kgsUrl = `https://khanglobalstudies.com/player?vvid=${video.id}`;
        const thumbImg = video.thumb
          ? `<img src="${video.thumb}" alt="Thumbnail">`
          : `<div style="height:150px;background:#ccc;text-align:center;line-height:150px;">No Thumbnail</div>`;

        videoContainer.innerHTML += `
          <div class="item">
            ${thumbImg}
            <h3>${video.name}</h3>
            <div class="btns">
              <a class="kgs-btn" href="${kgsUrl}" target="_blank">KGS</a>
              ${youtubeUrl ? `<a class="yt-btn" href="${youtubeUrl}" target="_blank">YouTube</a>` : `<a class="yt-btn disabled">YouTube</a>`}
            </div>
          </div>
        `;
      });

      allNotes.forEach(note => {
        notesContainer.innerHTML += `
          <div class="item">
            <div class="pdf-item-name">
              <span class="pdf-icon">üìÑ</span>
              <h3>${note.name}</h3>
            </div>
            <div class="btns">
              <a class="download-btn" href="${note.video_url}" target="_blank">Download</a>
            </div>
          </div>
        `;
      });
    }

    function extractYouTubeId(input) {
      if (!input) return null;
      const ytRegex = /(?:embed\/|watch\?v=|youtu\.be\/|vi\/|\/v\/|\/e\/|watch\?.+&v=)([a-zA-Z0-9_-]{11})|i\.ytimg\.com\/vi\/([a-zA-Z0-9_-]{11})/;
      const match = input.match(ytRegex);
      return match ? (match[1] || match[2]) : null;
    }

    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
      });
    });

    extractBtn.addEventListener('click', () => {
      let htmlContent = `<h2>${titleEl.textContent}</h2>`;

      allVideos.forEach(v => {
        htmlContent += `<p><strong>${v.name}</strong><br>üîó https://khanglobalstudies.com/player?vvid=${v.id}</p>`;
      });

      allNotes.forEach(n => {
        htmlContent += `<p><strong>${n.name}</strong><br>üìÑ <a href='${n.video_url}'>${n.video_url}</a></p>`;
      });

      const blob = new Blob([htmlContent], { type: "text/html" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = `${titleEl.textContent.replace(/\s+/g, '_')}_extracted.html`;
      link.click();
    });
  </script></body>
</html>
